{"remainingRequest":"/Users/moritzmurauer/dev/ap/muso-ninjas/node_modules/babel-loader/lib/index.js!/Users/moritzmurauer/dev/ap/muso-ninjas/src/composables/getCollection.js","dependencies":[{"path":"/Users/moritzmurauer/dev/ap/muso-ninjas/src/composables/getCollection.js","mtime":1606756817000},{"path":"/Users/moritzmurauer/dev/ap/muso-ninjas/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/moritzmurauer/dev/ap/muso-ninjas/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL21vcml0em11cmF1ZXIvZGV2L2FwL211c28tbmluamFzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvVXNlcnMvbW9yaXR6bXVyYXVlci9kZXYvYXAvbXVzby1uaW5qYXMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IHsgcmVmLCB3YXRjaEVmZmVjdCB9IGZyb20gJ3Z1ZSc7CmltcG9ydCB7IHByb2plY3RGaXJlc3RvcmUgfSBmcm9tICcuLi9maXJlYmFzZS9jb25maWcnOwoKdmFyIGdldENvbGxlY3Rpb24gPSBmdW5jdGlvbiBnZXRDb2xsZWN0aW9uKGNvbGxlY3Rpb24sIHF1ZXJ5KSB7CiAgdmFyIGRvY3VtZW50cyA9IHJlZihudWxsKTsKICB2YXIgZXJyb3IgPSByZWYobnVsbCk7IC8vIHJlZ2lzdGVyIHRoZSBmaXJlc3RvcmUgY29sbGVjdGlvbiByZWZlcmVuY2UKCiAgdmFyIGNvbGxlY3Rpb25SZWYgPSBwcm9qZWN0RmlyZXN0b3JlLmNvbGxlY3Rpb24oY29sbGVjdGlvbikub3JkZXJCeSgnY3JlYXRlZEF0Jyk7CgogIGlmIChxdWVyeSkgewogICAgdmFyIF9jb2xsZWN0aW9uUmVmOwoKICAgIGNvbGxlY3Rpb25SZWYgPSAoX2NvbGxlY3Rpb25SZWYgPSBjb2xsZWN0aW9uUmVmKS53aGVyZS5hcHBseShfY29sbGVjdGlvblJlZiwgX3RvQ29uc3VtYWJsZUFycmF5KHF1ZXJ5KSk7CiAgfQoKICB2YXIgdW5zdWIgPSBjb2xsZWN0aW9uUmVmLm9uU25hcHNob3QoZnVuY3Rpb24gKHNuYXApIHsKICAgIHZhciByZXN1bHRzID0gW107CiAgICBzbmFwLmRvY3MuZm9yRWFjaChmdW5jdGlvbiAoZG9jKSB7CiAgICAgIC8vIG11c3Qgd2FpdCBmb3IgdGhlIHNlcnZlciB0byBjcmVhdGUgdGhlIHRpbWVzdGFtcCAmIHNlbmQgaXQgYmFjawogICAgICBkb2MuZGF0YSgpLmNyZWF0ZWRBdCAmJiByZXN1bHRzLnB1c2goX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBkb2MuZGF0YSgpKSwge30sIHsKICAgICAgICBpZDogZG9jLmlkCiAgICAgIH0pKTsKICAgIH0pOyAvLyB1cGRhdGUgdmFsdWVzCgogICAgZG9jdW1lbnRzLnZhbHVlID0gcmVzdWx0czsKICAgIGVycm9yLnZhbHVlID0gbnVsbDsKICB9LCBmdW5jdGlvbiAoZXJyKSB7CiAgICBjb25zb2xlLmxvZyhlcnIubWVzc2FnZSk7CiAgICBkb2N1bWVudHMudmFsdWUgPSBudWxsOwogICAgZXJyb3IudmFsdWUgPSAnY291bGQgbm90IGZldGNoIHRoZSBkYXRhJzsKICB9KTsKICB3YXRjaEVmZmVjdChmdW5jdGlvbiAob25JbnZhbGlkYXRlKSB7CiAgICBvbkludmFsaWRhdGUoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdW5zdWIoKTsKICAgIH0pOwogIH0pOwogIHJldHVybiB7CiAgICBlcnJvcjogZXJyb3IsCiAgICBkb2N1bWVudHM6IGRvY3VtZW50cwogIH07Cn07CgpleHBvcnQgZGVmYXVsdCBnZXRDb2xsZWN0aW9uOw=="},{"version":3,"sources":["/Users/moritzmurauer/dev/ap/muso-ninjas/src/composables/getCollection.js"],"names":["ref","watchEffect","projectFirestore","getCollection","collection","query","documents","error","collectionRef","orderBy","where","unsub","onSnapshot","snap","results","docs","forEach","doc","data","createdAt","push","id","value","err","console","log","message","onInvalidate"],"mappings":";;;;AAAA,SAASA,GAAT,EAAcC,WAAd,QAAiC,KAAjC;AACA,SAASC,gBAAT,QAAiC,oBAAjC;;AAEA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,UAAD,EAAaC,KAAb,EAAuB;AAE3C,MAAMC,SAAS,GAAGN,GAAG,CAAC,IAAD,CAArB;AACA,MAAMO,KAAK,GAAGP,GAAG,CAAC,IAAD,CAAjB,CAH2C,CAK3C;;AACA,MAAIQ,aAAa,GAAGN,gBAAgB,CAACE,UAAjB,CAA4BA,UAA5B,EACjBK,OADiB,CACT,WADS,CAApB;;AAGA,MAAIJ,KAAJ,EAAW;AAAA;;AACTG,IAAAA,aAAa,GAAG,kBAAAA,aAAa,EAACE,KAAd,0CAAuBL,KAAvB,EAAhB;AACD;;AAED,MAAMM,KAAK,GAAGH,aAAa,CAACI,UAAd,CAAyB,UAAAC,IAAI,EAAI;AAC7C,QAAIC,OAAO,GAAG,EAAd;AACAD,IAAAA,IAAI,CAACE,IAAL,CAAUC,OAAV,CAAkB,UAAAC,GAAG,EAAI;AACvB;AACAA,MAAAA,GAAG,CAACC,IAAJ,GAAWC,SAAX,IAAwBL,OAAO,CAACM,IAAR,iCAAiBH,GAAG,CAACC,IAAJ,EAAjB;AAA6BG,QAAAA,EAAE,EAAEJ,GAAG,CAACI;AAArC,SAAxB;AACD,KAHD,EAF6C,CAO7C;;AACAf,IAAAA,SAAS,CAACgB,KAAV,GAAkBR,OAAlB;AACAP,IAAAA,KAAK,CAACe,KAAN,GAAc,IAAd;AACD,GAVa,EAUX,UAAAC,GAAG,EAAI;AACRC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACG,OAAhB;AACApB,IAAAA,SAAS,CAACgB,KAAV,GAAkB,IAAlB;AACAf,IAAAA,KAAK,CAACe,KAAN,GAAc,0BAAd;AACD,GAda,CAAd;AAgBArB,EAAAA,WAAW,CAAC,UAAC0B,YAAD,EAAkB;AAC5BA,IAAAA,YAAY,CAAC;AAAA,aAAMhB,KAAK,EAAX;AAAA,KAAD,CAAZ;AACD,GAFU,CAAX;AAIA,SAAO;AAAEJ,IAAAA,KAAK,EAALA,KAAF;AAASD,IAAAA,SAAS,EAATA;AAAT,GAAP;AACD,CAlCD;;AAoCA,eAAeH,aAAf","sourcesContent":["import { ref, watchEffect } from 'vue'\nimport { projectFirestore } from '../firebase/config'\n\nconst getCollection = (collection, query) => {\n\n  const documents = ref(null)\n  const error = ref(null)\n\n  // register the firestore collection reference\n  let collectionRef = projectFirestore.collection(collection)\n    .orderBy('createdAt')\n\n  if (query) {\n    collectionRef = collectionRef.where(...query)\n  }\n\n  const unsub = collectionRef.onSnapshot(snap => {\n    let results = []\n    snap.docs.forEach(doc => {\n      // must wait for the server to create the timestamp & send it back\n      doc.data().createdAt && results.push({...doc.data(), id: doc.id})\n    });\n    \n    // update values\n    documents.value = results\n    error.value = null\n  }, err => {\n    console.log(err.message)\n    documents.value = null\n    error.value = 'could not fetch the data'\n  })\n\n  watchEffect((onInvalidate) => {\n    onInvalidate(() => unsub());\n  });\n\n  return { error, documents }\n}\n\nexport default getCollection"]}]}